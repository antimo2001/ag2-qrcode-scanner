!function(){function e(e,t){this.count=e,this.dataCodewords=t,this.__defineGetter__("Count",function(){return this.count}),this.__defineGetter__("DataCodewords",function(){return this.dataCodewords})}function t(e,t,n){this.ecCodewordsPerBlock=e,n?this.ecBlocks=new Array(t,n):this.ecBlocks=new Array(t),this.__defineGetter__("ECCodewordsPerBlock",function(){return this.ecCodewordsPerBlock}),this.__defineGetter__("TotalECCodewords",function(){return this.ecCodewordsPerBlock*this.NumBlocks}),this.__defineGetter__("NumBlocks",function(){for(var e=0,t=0;t<this.ecBlocks.length;t++)e+=this.ecBlocks[t].length;return e}),this.getECBlocks=function(){return this.ecBlocks}}function n(e,t,n,r,i,a){this.versionNumber=e,this.alignmentPatternCenters=t,this.ecBlocks=new Array(n,r,i,a);for(var o=0,s=n.ECCodewordsPerBlock,d=n.getECBlocks(),h=0;h<d.length;h++){var u=d[h];o+=u.Count*(u.DataCodewords+s)}this.totalCodewords=o,this.__defineGetter__("VersionNumber",function(){return this.versionNumber}),this.__defineGetter__("AlignmentPatternCenters",function(){return this.alignmentPatternCenters}),this.__defineGetter__("TotalCodewords",function(){return this.totalCodewords}),this.__defineGetter__("DimensionForVersion",function(){return 17+4*this.versionNumber}),this.buildFunctionPattern=function(){var e=this.DimensionForVersion,t=new c(e);t.setRegion(0,0,9,9),t.setRegion(e-8,0,8,9),t.setRegion(0,e-8,9,8);for(var n=this.alignmentPatternCenters.length,r=0;r<n;r++)for(var i=this.alignmentPatternCenters[r]-2,a=0;a<n;a++)0==r&&(0==a||a==n-1)||r==n-1&&0==a||t.setRegion(this.alignmentPatternCenters[a]-2,i,5,5);return t.setRegion(6,9,1,e-17),t.setRegion(9,6,e-17,1),this.versionNumber>6&&(t.setRegion(e-11,0,3,6),t.setRegion(0,e-11,6,3)),t},this.getECBlocksForLevel=function(e){return this.ecBlocks[e.ordinal()]}}function r(){return new Array(new n(1,new Array,new t(7,new e(1,19)),new t(10,new e(1,16)),new t(13,new e(1,13)),new t(17,new e(1,9))),new n(2,new Array(6,18),new t(10,new e(1,34)),new t(16,new e(1,28)),new t(22,new e(1,22)),new t(28,new e(1,16))),new n(3,new Array(6,22),new t(15,new e(1,55)),new t(26,new e(1,44)),new t(18,new e(2,17)),new t(22,new e(2,13))),new n(4,new Array(6,26),new t(20,new e(1,80)),new t(18,new e(2,32)),new t(26,new e(2,24)),new t(16,new e(4,9))),new n(5,new Array(6,30),new t(26,new e(1,108)),new t(24,new e(2,43)),new t(18,new e(2,15),new e(2,16)),new t(22,new e(2,11),new e(2,12))),new n(6,new Array(6,34),new t(18,new e(2,68)),new t(16,new e(4,27)),new t(24,new e(4,19)),new t(28,new e(4,15))),new n(7,new Array(6,22,38),new t(20,new e(2,78)),new t(18,new e(4,31)),new t(18,new e(2,14),new e(4,15)),new t(26,new e(4,13),new e(1,14))),new n(8,new Array(6,24,42),new t(24,new e(2,97)),new t(22,new e(2,38),new e(2,39)),new t(22,new e(4,18),new e(2,19)),new t(26,new e(4,14),new e(2,15))),new n(9,new Array(6,26,46),new t(30,new e(2,116)),new t(22,new e(3,36),new e(2,37)),new t(20,new e(4,16),new e(4,17)),new t(24,new e(4,12),new e(4,13))),new n(10,new Array(6,28,50),new t(18,new e(2,68),new e(2,69)),new t(26,new e(4,43),new e(1,44)),new t(24,new e(6,19),new e(2,20)),new t(28,new e(6,15),new e(2,16))),new n(11,new Array(6,30,54),new t(20,new e(4,81)),new t(30,new e(1,50),new e(4,51)),new t(28,new e(4,22),new e(4,23)),new t(24,new e(3,12),new e(8,13))),new n(12,new Array(6,32,58),new t(24,new e(2,92),new e(2,93)),new t(22,new e(6,36),new e(2,37)),new t(26,new e(4,20),new e(6,21)),new t(28,new e(7,14),new e(4,15))),new n(13,new Array(6,34,62),new t(26,new e(4,107)),new t(22,new e(8,37),new e(1,38)),new t(24,new e(8,20),new e(4,21)),new t(22,new e(12,11),new e(4,12))),new n(14,new Array(6,26,46,66),new t(30,new e(3,115),new e(1,116)),new t(24,new e(4,40),new e(5,41)),new t(20,new e(11,16),new e(5,17)),new t(24,new e(11,12),new e(5,13))),new n(15,new Array(6,26,48,70),new t(22,new e(5,87),new e(1,88)),new t(24,new e(5,41),new e(5,42)),new t(30,new e(5,24),new e(7,25)),new t(24,new e(11,12),new e(7,13))),new n(16,new Array(6,26,50,74),new t(24,new e(5,98),new e(1,99)),new t(28,new e(7,45),new e(3,46)),new t(24,new e(15,19),new e(2,20)),new t(30,new e(3,15),new e(13,16))),new n(17,new Array(6,30,54,78),new t(28,new e(1,107),new e(5,108)),new t(28,new e(10,46),new e(1,47)),new t(28,new e(1,22),new e(15,23)),new t(28,new e(2,14),new e(17,15))),new n(18,new Array(6,30,56,82),new t(30,new e(5,120),new e(1,121)),new t(26,new e(9,43),new e(4,44)),new t(28,new e(17,22),new e(1,23)),new t(28,new e(2,14),new e(19,15))),new n(19,new Array(6,30,58,86),new t(28,new e(3,113),new e(4,114)),new t(26,new e(3,44),new e(11,45)),new t(26,new e(17,21),new e(4,22)),new t(26,new e(9,13),new e(16,14))),new n(20,new Array(6,34,62,90),new t(28,new e(3,107),new e(5,108)),new t(26,new e(3,41),new e(13,42)),new t(30,new e(15,24),new e(5,25)),new t(28,new e(15,15),new e(10,16))),new n(21,new Array(6,28,50,72,94),new t(28,new e(4,116),new e(4,117)),new t(26,new e(17,42)),new t(28,new e(17,22),new e(6,23)),new t(30,new e(19,16),new e(6,17))),new n(22,new Array(6,26,50,74,98),new t(28,new e(2,111),new e(7,112)),new t(28,new e(17,46)),new t(30,new e(7,24),new e(16,25)),new t(24,new e(34,13))),new n(23,new Array(6,30,54,74,102),new t(30,new e(4,121),new e(5,122)),new t(28,new e(4,47),new e(14,48)),new t(30,new e(11,24),new e(14,25)),new t(30,new e(16,15),new e(14,16))),new n(24,new Array(6,28,54,80,106),new t(30,new e(6,117),new e(4,118)),new t(28,new e(6,45),new e(14,46)),new t(30,new e(11,24),new e(16,25)),new t(30,new e(30,16),new e(2,17))),new n(25,new Array(6,32,58,84,110),new t(26,new e(8,106),new e(4,107)),new t(28,new e(8,47),new e(13,48)),new t(30,new e(7,24),new e(22,25)),new t(30,new e(22,15),new e(13,16))),new n(26,new Array(6,30,58,86,114),new t(28,new e(10,114),new e(2,115)),new t(28,new e(19,46),new e(4,47)),new t(28,new e(28,22),new e(6,23)),new t(30,new e(33,16),new e(4,17))),new n(27,new Array(6,34,62,90,118),new t(30,new e(8,122),new e(4,123)),new t(28,new e(22,45),new e(3,46)),new t(30,new e(8,23),new e(26,24)),new t(30,new e(12,15),new e(28,16))),new n(28,new Array(6,26,50,74,98,122),new t(30,new e(3,117),new e(10,118)),new t(28,new e(3,45),new e(23,46)),new t(30,new e(4,24),new e(31,25)),new t(30,new e(11,15),new e(31,16))),new n(29,new Array(6,30,54,78,102,126),new t(30,new e(7,116),new e(7,117)),new t(28,new e(21,45),new e(7,46)),new t(30,new e(1,23),new e(37,24)),new t(30,new e(19,15),new e(26,16))),new n(30,new Array(6,26,52,78,104,130),new t(30,new e(5,115),new e(10,116)),new t(28,new e(19,47),new e(10,48)),new t(30,new e(15,24),new e(25,25)),new t(30,new e(23,15),new e(25,16))),new n(31,new Array(6,30,56,82,108,134),new t(30,new e(13,115),new e(3,116)),new t(28,new e(2,46),new e(29,47)),new t(30,new e(42,24),new e(1,25)),new t(30,new e(23,15),new e(28,16))),new n(32,new Array(6,34,60,86,112,138),new t(30,new e(17,115)),new t(28,new e(10,46),new e(23,47)),new t(30,new e(10,24),new e(35,25)),new t(30,new e(19,15),new e(35,16))),new n(33,new Array(6,30,58,86,114,142),new t(30,new e(17,115),new e(1,116)),new t(28,new e(14,46),new e(21,47)),new t(30,new e(29,24),new e(19,25)),new t(30,new e(11,15),new e(46,16))),new n(34,new Array(6,34,62,90,118,146),new t(30,new e(13,115),new e(6,116)),new t(28,new e(14,46),new e(23,47)),new t(30,new e(44,24),new e(7,25)),new t(30,new e(59,16),new e(1,17))),new n(35,new Array(6,30,54,78,102,126,150),new t(30,new e(12,121),new e(7,122)),new t(28,new e(12,47),new e(26,48)),new t(30,new e(39,24),new e(14,25)),new t(30,new e(22,15),new e(41,16))),new n(36,new Array(6,24,50,76,102,128,154),new t(30,new e(6,121),new e(14,122)),new t(28,new e(6,47),new e(34,48)),new t(30,new e(46,24),new e(10,25)),new t(30,new e(2,15),new e(64,16))),new n(37,new Array(6,28,54,80,106,132,158),new t(30,new e(17,122),new e(4,123)),new t(28,new e(29,46),new e(14,47)),new t(30,new e(49,24),new e(10,25)),new t(30,new e(24,15),new e(46,16))),new n(38,new Array(6,32,58,84,110,136,162),new t(30,new e(4,122),new e(18,123)),new t(28,new e(13,46),new e(32,47)),new t(30,new e(48,24),new e(14,25)),new t(30,new e(42,15),new e(32,16))),new n(39,new Array(6,26,54,82,110,138,166),new t(30,new e(20,117),new e(4,118)),new t(28,new e(40,47),new e(7,48)),new t(30,new e(43,24),new e(22,25)),new t(30,new e(10,15),new e(67,16))),new n(40,new Array(6,30,58,86,114,142,170),new t(30,new e(19,118),new e(6,119)),new t(28,new e(18,47),new e(31,48)),new t(30,new e(34,24),new e(34,25)),new t(30,new e(20,15),new e(61,16))))}function i(e,t,n,r,a,o,s,c,d){this.a11=e,this.a12=r,this.a13=s,this.a21=t,this.a22=a,this.a23=c,this.a31=n,this.a32=o,this.a33=d,this.transformPoints1=function(e){for(var t=e.length,n=this.a11,r=this.a12,i=this.a13,a=this.a21,o=this.a22,s=this.a23,c=this.a31,d=this.a32,h=this.a33,u=0;u<t;u+=2){var f=e[u],l=e[u+1],w=i*f+s*l+h;e[u]=(n*f+a*l+c)/w,e[u+1]=(r*f+o*l+d)/w}},this.transformPoints2=function(e,t){for(var n=e.length,r=0;r<n;r++){var i=e[r],a=t[r],o=this.a13*i+this.a23*a+this.a33;e[r]=(this.a11*i+this.a21*a+this.a31)/o,t[r]=(this.a12*i+this.a22*a+this.a32)/o}},this.buildAdjoint=function(){return new i(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)},this.times=function(e){return new i(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)}}function a(e){function t(e,t){this.bits=e,this.points=t}this.image=e,this.resultPointCallback=null,this.sizeOfBlackWhiteBlackRun=function(e,t,n,r){var i=Math.abs(r-t)>Math.abs(n-e);if(i){var a=e;e=t,t=a,a=n,n=r,r=a}for(var o=Math.abs(n-e),s=Math.abs(r-t),c=-o>>1,d=t<r?1:-1,h=e<n?1:-1,u=0,f=e,l=t;f!=n;f+=h){var w=i?l:f,p=i?f:l;if(1==u?this.image[w+p*G.width]&&u++:this.image[w+p*G.width]||u++,3==u){var m=f-e,v=l-t;return Math.sqrt(m*m+v*v)}if(c+=s,c>0){if(l==r)break;l+=d,c-=o}}var g=n-e,y=r-t;return Math.sqrt(g*g+y*y)},this.sizeOfBlackWhiteBlackRunBothWays=function(e,t,n,r){var i=this.sizeOfBlackWhiteBlackRun(e,t,n,r),a=1,o=e-(n-e);o<0?(a=e/(e-o),o=0):o>=G.width&&(a=(G.width-1-e)/(o-e),o=G.width-1);var s=Math.floor(t-(r-t)*a);return a=1,s<0?(a=t/(t-s),s=0):s>=G.height&&(a=(G.height-1-t)/(s-t),s=G.height-1),o=Math.floor(e+(o-e)*a),i+=this.sizeOfBlackWhiteBlackRun(e,t,o,s),i-1},this.calculateModuleSizeOneWay=function(e,t){var n=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.X),Math.floor(e.Y),Math.floor(t.X),Math.floor(t.Y)),r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.X),Math.floor(t.Y),Math.floor(e.X),Math.floor(e.Y));return isNaN(n)?r/7:isNaN(r)?n/7:(n+r)/14},this.calculateModuleSize=function(e,t,n){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,n))/2},this.distance=function(e,t){return xDiff=e.X-t.X,yDiff=e.Y-t.Y,Math.sqrt(xDiff*xDiff+yDiff*yDiff)},this.computeDimension=function(e,t,n,r){var i=Math.round(this.distance(e,t)/r),a=Math.round(this.distance(e,n)/r),o=(i+a>>1)+7;switch(3&o){case 0:o++;break;case 2:o--;break;case 3:throw"Error"}return o},this.findAlignmentInRegion=function(e,t,n,r){var i=Math.floor(r*e),a=Math.max(0,t-i),o=Math.min(G.width-1,t+i);if(o-a<3*e)throw"Error";var s=Math.max(0,n-i),c=Math.min(G.height-1,n+i),d=new E(this.image,a,s,o-a,c-s,e,this.resultPointCallback);return d.find()},this.createTransform=function(e,t,n,r,a){var o,s,c,d,h=a-3.5;null!=r?(o=r.X,s=r.Y,c=d=h-3):(o=t.X-e.X+n.X,s=t.Y-e.Y+n.Y,c=d=h);var u=i.quadrilateralToQuadrilateral(3.5,3.5,h,3.5,c,d,3.5,h,e.X,e.Y,t.X,t.Y,o,s,n.X,n.Y);return u},this.sampleGrid=function(e,t,n){var r=GridSampler;return r.sampleGrid3(e,n,t)},this.processFinderPatternInfo=function(e){var r=e.TopLeft,i=e.TopRight,a=e.BottomLeft,o=this.calculateModuleSize(r,i,a);if(o<1)throw"Error";var s=this.computeDimension(r,i,a,o),c=n.getProvisionalVersionForDimension(s),d=c.DimensionForVersion-7,h=null;if(c.AlignmentPatternCenters.length>0)for(var u=i.X-r.X+a.X,f=i.Y-r.Y+a.Y,l=1-3/d,w=Math.floor(r.X+l*(u-r.X)),p=Math.floor(r.Y+l*(f-r.Y)),m=4;m<=16;m<<=1){h=this.findAlignmentInRegion(o,w,p,m);break}var v,g=this.createTransform(r,i,a,h,s),y=this.sampleGrid(this.image,g,s);return v=null==h?new Array(a,r,i):new Array(a,r,i,h),new t(y,v)},this.detect=function(){var e=(new _).findFinderPattern(this.image);return this.processFinderPatternInfo(e)}}function o(e){this.errorCorrectionLevel=s.forBits(e>>3&3),this.dataMask=7&e,this.__defineGetter__("ErrorCorrectionLevel",function(){return this.errorCorrectionLevel}),this.__defineGetter__("DataMask",function(){return this.dataMask}),this.GetHashCode=function(){return this.errorCorrectionLevel.ordinal()<<3|dataMask},this.Equals=function(e){var t=e;return this.errorCorrectionLevel==t.errorCorrectionLevel&&this.dataMask==t.dataMask}}function s(e,t,n){this.ordinal_Renamed_Field=e,this.bits=t,this.name=n,this.__defineGetter__("Bits",function(){return this.bits}),this.__defineGetter__("Name",function(){return this.name}),this.ordinal=function(){return this.ordinal_Renamed_Field}}function c(e,t){if(t||(t=e),e<1||t<1)throw"Both dimensions must be greater than 0";this.width=e,this.height=t;var n=e>>5;0!=(31&e)&&n++,this.rowSize=n,this.bits=new Array(n*t);for(var r=0;r<this.bits.length;r++)this.bits[r]=0;this.__defineGetter__("Width",function(){return this.width}),this.__defineGetter__("Height",function(){return this.height}),this.__defineGetter__("Dimension",function(){if(this.width!=this.height)throw"Can't call getDimension() on a non-square matrix";return this.width}),this.get_Renamed=function(e,t){var n=t*this.rowSize+(e>>5);return 0!=(1&S(this.bits[n],31&e))},this.set_Renamed=function(e,t){var n=t*this.rowSize+(e>>5);this.bits[n]|=1<<(31&e)},this.flip=function(e,t){var n=t*this.rowSize+(e>>5);this.bits[n]^=1<<(31&e)},this.clear=function(){for(var e=this.bits.length,t=0;t<e;t++)this.bits[t]=0},this.setRegion=function(e,t,n,r){if(t<0||e<0)throw"Left and top must be nonnegative";if(r<1||n<1)throw"Height and width must be at least 1";var i=e+n,a=t+r;if(a>this.height||i>this.width)throw"The region must fit inside the matrix";for(var o=t;o<a;o++)for(var s=o*this.rowSize,c=e;c<i;c++)this.bits[s+(c>>5)]|=1<<(31&c)}}function d(e,t){this.numDataCodewords=e,this.codewords=t,this.__defineGetter__("NumDataCodewords",function(){return this.numDataCodewords}),this.__defineGetter__("Codewords",function(){return this.codewords})}function h(e){var t=e.Dimension;if(t<21||1!=(3&t))throw"Error BitMatrixParser";this.bitMatrix=e,this.parsedVersion=null,this.parsedFormatInfo=null,this.copyBit=function(e,t,n){return this.bitMatrix.get_Renamed(e,t)?n<<1|1:n<<1},this.readFormatInformation=function(){if(null!=this.parsedFormatInfo)return this.parsedFormatInfo;for(var e=0,t=0;t<6;t++)e=this.copyBit(t,8,e);e=this.copyBit(7,8,e),e=this.copyBit(8,8,e),e=this.copyBit(8,7,e);for(var n=5;n>=0;n--)e=this.copyBit(8,n,e);if(this.parsedFormatInfo=o.decodeFormatInformation(e),null!=this.parsedFormatInfo)return this.parsedFormatInfo;var r=this.bitMatrix.Dimension;e=0;for(var i=r-8,t=r-1;t>=i;t--)e=this.copyBit(t,8,e);for(var n=r-7;n<r;n++)e=this.copyBit(8,n,e);if(this.parsedFormatInfo=o.decodeFormatInformation(e),null!=this.parsedFormatInfo)return this.parsedFormatInfo;throw"Error readFormatInformation"},this.readVersion=function(){if(null!=this.parsedVersion)return this.parsedVersion;var e=this.bitMatrix.Dimension,t=e-17>>2;if(t<=6)return n.getVersionForNumber(t);for(var r=0,i=e-11,a=5;a>=0;a--)for(var o=e-9;o>=i;o--)r=this.copyBit(o,a,r);if(this.parsedVersion=n.decodeVersionInformation(r),null!=this.parsedVersion&&this.parsedVersion.DimensionForVersion==e)return this.parsedVersion;r=0;for(var o=5;o>=0;o--)for(var a=e-9;a>=i;a--)r=this.copyBit(o,a,r);if(this.parsedVersion=n.decodeVersionInformation(r),null!=this.parsedVersion&&this.parsedVersion.DimensionForVersion==e)return this.parsedVersion;throw"Error readVersion"},this.readCodewords=function(){var e=this.readFormatInformation(),t=this.readVersion(),n=DataMask.forReference(e.DataMask),r=this.bitMatrix.Dimension;n.unmaskBitMatrix(this.bitMatrix,r);for(var i=t.buildFunctionPattern(),a=!0,o=new Array(t.TotalCodewords),s=0,c=0,d=0,h=r-1;h>0;h-=2){6==h&&h--;for(var u=0;u<r;u++)for(var f=a?r-1-u:u,l=0;l<2;l++)i.get_Renamed(h-l,f)||(d++,c<<=1,this.bitMatrix.get_Renamed(h-l,f)&&(c|=1),8==d&&(o[s++]=c,d=0,c=0));a^=!0}if(s!=t.TotalCodewords)throw"Error readCodewords";return o}}function u(){this.unmaskBitMatrix=function(e,t){for(var n=0;n<t;n++)for(var r=0;r<t;r++)this.isMasked(n,r)&&e.flip(r,n)},this.isMasked=function(e,t){return 0==(e+t&1)}}function f(){this.unmaskBitMatrix=function(e,t){for(var n=0;n<t;n++)for(var r=0;r<t;r++)this.isMasked(n,r)&&e.flip(r,n)},this.isMasked=function(e,t){return 0==(1&e)}}function l(){this.unmaskBitMatrix=function(e,t){for(var n=0;n<t;n++)for(var r=0;r<t;r++)this.isMasked(n,r)&&e.flip(r,n)},this.isMasked=function(e,t){return t%3==0}}function w(){this.unmaskBitMatrix=function(e,t){for(var n=0;n<t;n++)for(var r=0;r<t;r++)this.isMasked(n,r)&&e.flip(r,n)},this.isMasked=function(e,t){return(e+t)%3==0}}function p(){this.unmaskBitMatrix=function(e,t){for(var n=0;n<t;n++)for(var r=0;r<t;r++)this.isMasked(n,r)&&e.flip(r,n)},this.isMasked=function(e,t){return 0==(S(e,1)+t/3&1)}}function m(){this.unmaskBitMatrix=function(e,t){for(var n=0;n<t;n++)for(var r=0;r<t;r++)this.isMasked(n,r)&&e.flip(r,n)},this.isMasked=function(e,t){var n=e*t;return(1&n)+n%3==0}}function v(){this.unmaskBitMatrix=function(e,t){for(var n=0;n<t;n++)for(var r=0;r<t;r++)this.isMasked(n,r)&&e.flip(r,n)},this.isMasked=function(e,t){var n=e*t;return 0==((1&n)+n%3&1)}}function g(){this.unmaskBitMatrix=function(e,t){for(var n=0;n<t;n++)for(var r=0;r<t;r++)this.isMasked(n,r)&&e.flip(r,n)},this.isMasked=function(e,t){return 0==((e+t&1)+e*t%3&1)}}function y(e){this.field=e,this.decode=function(e,t){for(var n=new b(this.field,e),r=new Array(t),i=0;i<r.length;i++)r[i]=0;for(var a=!1,o=!0,i=0;i<t;i++){var s=n.evaluateAt(this.field.exp(a?i+1:i));r[r.length-1-i]=s,0!=s&&(o=!1)}if(!o)for(var c=new b(this.field,r),d=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),c,t),h=d[0],u=d[1],f=this.findErrorLocations(h),l=this.findErrorMagnitudes(u,f,a),i=0;i<f.length;i++){var w=e.length-1-this.field.log(f[i]);if(w<0)throw"ReedSolomonException Bad error location";e[w]=C.addOrSubtract(e[w],l[i])}},this.runEuclideanAlgorithm=function(e,t,n){if(e.Degree<t.Degree){var r=e;e=t,t=r}for(var i=e,a=t,o=this.field.One,s=this.field.Zero,c=this.field.Zero,d=this.field.One;a.Degree>=Math.floor(n/2);){var h=i,u=o,f=c;if(i=a,o=s,c=d,i.Zero)throw"r_{i-1} was zero";a=h;for(var l=this.field.Zero,w=i.getCoefficient(i.Degree),p=this.field.inverse(w);a.Degree>=i.Degree&&!a.Zero;){var m=a.Degree-i.Degree,v=this.field.multiply(a.getCoefficient(a.Degree),p);l=l.addOrSubtract(this.field.buildMonomial(m,v)),a=a.addOrSubtract(i.multiplyByMonomial(m,v))}s=l.multiply1(o).addOrSubtract(u),d=l.multiply1(c).addOrSubtract(f)}var g=d.getCoefficient(0);if(0==g)throw"ReedSolomonException sigmaTilde(0) was zero";var y=this.field.inverse(g),b=d.multiply2(y),C=a.multiply2(y);return new Array(b,C)},this.findErrorLocations=function(e){var t=e.Degree;if(1==t)return new Array(e.getCoefficient(1));for(var n=new Array(t),r=0,i=1;i<256&&r<t;i++)0==e.evaluateAt(i)&&(n[r]=this.field.inverse(i),r++);if(r!=t)throw"Error locator degree does not match number of roots";return n},this.findErrorMagnitudes=function(e,t,n){for(var r=t.length,i=new Array(r),a=0;a<r;a++){for(var o=this.field.inverse(t[a]),s=1,c=0;c<r;c++)a!=c&&(s=this.field.multiply(s,C.addOrSubtract(1,this.field.multiply(t[c],o))));i[a]=this.field.multiply(e.evaluateAt(o),this.field.inverse(s)),n&&(i[a]=this.field.multiply(i[a],o))}return i}}function b(e,t){if(null==t||0==t.length)throw"System.ArgumentException";this.field=e;var n=t.length;if(n>1&&0==t[0]){for(var r=1;r<n&&0==t[r];)r++;if(r==n)this.coefficients=e.Zero.coefficients;else{this.coefficients=new Array(n-r);for(var i=0;i<this.coefficients.length;i++)this.coefficients[i]=0;for(var a=0;a<this.coefficients.length;a++)this.coefficients[a]=t[r+a]}}else this.coefficients=t;this.__defineGetter__("Zero",function(){return 0==this.coefficients[0]}),this.__defineGetter__("Degree",function(){return this.coefficients.length-1}),this.__defineGetter__("Coefficients",function(){return this.coefficients}),this.getCoefficient=function(e){return this.coefficients[this.coefficients.length-1-e]},this.evaluateAt=function(e){if(0==e)return this.getCoefficient(0);var t=this.coefficients.length;if(1==e){for(var n=0,r=0;r<t;r++)n=C.addOrSubtract(n,this.coefficients[r]);return n}for(var i=this.coefficients[0],r=1;r<t;r++)i=C.addOrSubtract(this.field.multiply(e,i),this.coefficients[r]);return i},this.addOrSubtract=function(t){if(this.field!=t.field)throw"GF256Polys do not have same GF256 field";if(this.Zero)return t;if(t.Zero)return this;var n=this.coefficients,r=t.coefficients;if(n.length>r.length){var i=n;n=r,r=i}for(var a=new Array(r.length),o=r.length-n.length,s=0;s<o;s++)a[s]=r[s];for(var c=o;c<r.length;c++)a[c]=C.addOrSubtract(n[c-o],r[c]);return new b(e,a)},this.multiply1=function(e){if(this.field!=e.field)throw"GF256Polys do not have same GF256 field";if(this.Zero||e.Zero)return this.field.Zero;for(var t=this.coefficients,n=t.length,r=e.coefficients,i=r.length,a=new Array(n+i-1),o=0;o<n;o++)for(var s=t[o],c=0;c<i;c++)a[o+c]=C.addOrSubtract(a[o+c],this.field.multiply(s,r[c]));return new b(this.field,a)},this.multiply2=function(e){if(0==e)return this.field.Zero;if(1==e)return this;for(var t=this.coefficients.length,n=new Array(t),r=0;r<t;r++)n[r]=this.field.multiply(this.coefficients[r],e);return new b(this.field,n)},this.multiplyByMonomial=function(e,t){if(e<0)throw"System.ArgumentException";if(0==t)return this.field.Zero;for(var n=this.coefficients.length,r=new Array(n+e),i=0;i<r.length;i++)r[i]=0;for(var i=0;i<n;i++)r[i]=this.field.multiply(this.coefficients[i],t);return new b(this.field,r)},this.divide=function(e){if(this.field!=e.field)throw"GF256Polys do not have same GF256 field";if(e.Zero)throw"Divide by 0";for(var t=this.field.Zero,n=this,r=e.getCoefficient(e.Degree),i=this.field.inverse(r);n.Degree>=e.Degree&&!n.Zero;){var a=n.Degree-e.Degree,o=this.field.multiply(n.getCoefficient(n.Degree),i),s=e.multiplyByMonomial(a,o),c=this.field.buildMonomial(a,o);t=t.addOrSubtract(c),n=n.addOrSubtract(s)}return new Array(t,n)}}function C(e){this.expTable=new Array(256),this.logTable=new Array(256);for(var t=1,n=0;n<256;n++)this.expTable[n]=t,t<<=1,t>=256&&(t^=e);for(var n=0;n<255;n++)this.logTable[this.expTable[n]]=n;var r=new Array(1);r[0]=0,this.zero=new b(this,new Array(r));var i=new Array(1);i[0]=1,this.one=new b(this,new Array(i)),this.__defineGetter__("Zero",function(){return this.zero}),this.__defineGetter__("One",function(){return this.one}),this.buildMonomial=function(e,t){if(e<0)throw"System.ArgumentException";if(0==t)return zero;for(var n=new Array(e+1),r=0;r<n.length;r++)n[r]=0;return n[0]=t,new b(this,n)},this.exp=function(e){return this.expTable[e]},this.log=function(e){if(0==e)throw"System.ArgumentException";return this.logTable[e]},this.inverse=function(e){if(0==e)throw"System.ArithmeticException";return this.expTable[255-this.logTable[e]]},this.multiply=function(e,t){return 0==e||0==t?0:1==e?t:1==t?e:this.expTable[(this.logTable[e]+this.logTable[t])%255]}}function S(e,t){return e>=0?e>>t:(e>>t)+(2<<~t)}function k(e,t,n){this.x=e,this.y=t,this.count=1,this.estimatedModuleSize=n,this.__defineGetter__("EstimatedModuleSize",function(){return this.estimatedModuleSize}),this.__defineGetter__("Count",function(){return this.count}),this.__defineGetter__("X",function(){return this.x}),this.__defineGetter__("Y",function(){return this.y}),this.incrementCount=function(){this.count++},this.aboutEquals=function(e,t,n){if(Math.abs(t-this.y)<=e&&Math.abs(n-this.x)<=e){var r=Math.abs(e-this.estimatedModuleSize);return r<=1||r/this.estimatedModuleSize<=1}return!1}}function P(e){this.bottomLeft=e[0],this.topLeft=e[1],this.topRight=e[2],this.__defineGetter__("BottomLeft",function(){return this.bottomLeft}),this.__defineGetter__("TopLeft",function(){return this.topLeft}),this.__defineGetter__("TopRight",function(){return this.topRight})}function _(){this.image=null,this.possibleCenters=[],this.hasSkipped=!1,this.crossCheckStateCount=new Array(0,0,0,0,0),this.resultPointCallback=null,this.__defineGetter__("CrossCheckStateCount",function(){return this.crossCheckStateCount[0]=0,this.crossCheckStateCount[1]=0,this.crossCheckStateCount[2]=0,this.crossCheckStateCount[3]=0,this.crossCheckStateCount[4]=0,this.crossCheckStateCount}),this.foundPatternCross=function(e){for(var t=0,n=0;n<5;n++){var r=e[n];if(0==r)return!1;t+=r}if(t<7)return!1;var i=Math.floor((t<<V)/7),a=Math.floor(i/2);return Math.abs(i-(e[0]<<V))<a&&Math.abs(i-(e[1]<<V))<a&&Math.abs(3*i-(e[2]<<V))<3*a&&Math.abs(i-(e[3]<<V))<a&&Math.abs(i-(e[4]<<V))<a},this.centerFromEnd=function(e,t){return t-e[4]-e[3]-e[2]/2},this.crossCheckVertical=function(e,t,n,r){for(var i=this.image,a=G.height,o=this.CrossCheckStateCount,s=e;s>=0&&i[t+s*G.width];)o[2]++,s--;if(s<0)return NaN;for(;s>=0&&!i[t+s*G.width]&&o[1]<=n;)o[1]++,s--;if(s<0||o[1]>n)return NaN;for(;s>=0&&i[t+s*G.width]&&o[0]<=n;)o[0]++,s--;if(o[0]>n)return NaN;for(s=e+1;s<a&&i[t+s*G.width];)o[2]++,s++;if(s==a)return NaN;for(;s<a&&!i[t+s*G.width]&&o[3]<n;)o[3]++,s++;if(s==a||o[3]>=n)return NaN;for(;s<a&&i[t+s*G.width]&&o[4]<n;)o[4]++,s++;if(o[4]>=n)return NaN;var c=o[0]+o[1]+o[2]+o[3]+o[4];return 5*Math.abs(c-r)>=2*r?NaN:this.foundPatternCross(o)?this.centerFromEnd(o,s):NaN},this.crossCheckHorizontal=function(e,t,n,r){for(var i=this.image,a=G.width,o=this.CrossCheckStateCount,s=e;s>=0&&i[s+t*G.width];)o[2]++,s--;if(s<0)return NaN;for(;s>=0&&!i[s+t*G.width]&&o[1]<=n;)o[1]++,s--;if(s<0||o[1]>n)return NaN;for(;s>=0&&i[s+t*G.width]&&o[0]<=n;)o[0]++,s--;if(o[0]>n)return NaN;for(s=e+1;s<a&&i[s+t*G.width];)o[2]++,s++;if(s==a)return NaN;for(;s<a&&!i[s+t*G.width]&&o[3]<n;)o[3]++,s++;if(s==a||o[3]>=n)return NaN;for(;s<a&&i[s+t*G.width]&&o[4]<n;)o[4]++,s++;if(o[4]>=n)return NaN;var c=o[0]+o[1]+o[2]+o[3]+o[4];return 5*Math.abs(c-r)>=r?NaN:this.foundPatternCross(o)?this.centerFromEnd(o,s):NaN},this.handlePossibleCenter=function(e,t,n){var r=e[0]+e[1]+e[2]+e[3]+e[4],i=this.centerFromEnd(e,n),a=this.crossCheckVertical(t,Math.floor(i),e[2],r);if(!isNaN(a)&&(i=this.crossCheckHorizontal(Math.floor(i),Math.floor(a),e[2],r),!isNaN(i))){for(var o=r/7,s=!1,c=this.possibleCenters.length,d=0;d<c;d++){var h=this.possibleCenters[d];if(h.aboutEquals(o,a,i)){h.incrementCount(),s=!0;break}}if(!s){var u=new k(i,a,o);this.possibleCenters.push(u),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(u)}return!0}return!1},this.selectBestPatterns=function(){var e=this.possibleCenters.length;if(e<3)throw"Couldn't find enough finder patterns";if(e>3){for(var t=0,n=0,r=0;r<e;r++){var i=this.possibleCenters[r].EstimatedModuleSize;t+=i,n+=i*i}var a=t/e;this.possibleCenters.sort(function(e,t){var n=Math.abs(t.EstimatedModuleSize-a),r=Math.abs(e.EstimatedModuleSize-a);return n<r?-1:n==r?0:1});for(var o=Math.sqrt(n/e-a*a),s=Math.max(.2*a,o),r=0;r<this.possibleCenters.length&&this.possibleCenters.length>3;r++){var c=this.possibleCenters[r];Math.abs(c.EstimatedModuleSize-a)>s&&(this.possibleCenters.remove(r),r--)}}return this.possibleCenters.length>3&&this.possibleCenters.sort(function(e,t){return e.count>t.count?-1:e.count<t.count?1:0}),new Array(this.possibleCenters[0],this.possibleCenters[1],this.possibleCenters[2])},this.findRowSkip=function(){var e=this.possibleCenters.length;if(e<=1)return 0;for(var t=null,n=0;n<e;n++){var r=this.possibleCenters[n];if(r.Count>=z){if(null!=t)return this.hasSkipped=!0,Math.floor((Math.abs(t.X-r.X)-Math.abs(t.Y-r.Y))/2);t=r}}return 0},this.haveMultiplyConfirmedCenters=function(){for(var e=0,t=0,n=this.possibleCenters.length,r=0;r<n;r++){var i=this.possibleCenters[r];i.Count>=z&&(e++,t+=i.EstimatedModuleSize)}if(e<3)return!1;for(var a=t/n,o=0,r=0;r<n;r++)i=this.possibleCenters[r],o+=Math.abs(i.EstimatedModuleSize-a);return o<=.05*t},this.findFinderPattern=function(e){var t=!1;this.image=e;var n=G.height,r=G.width,i=Math.floor(3*n/(4*U));(i<j||t)&&(i=j);for(var a=!1,o=new Array(5),s=i-1;s<n&&!a;s+=i){o[0]=0,o[1]=0,o[2]=0,o[3]=0,o[4]=0;for(var c=0,d=0;d<r;d++)if(e[d+s*G.width])1==(1&c)&&c++,o[c]++;else if(0==(1&c))if(4==c)if(this.foundPatternCross(o)){var h=this.handlePossibleCenter(o,s,d);if(h)if(i=2,this.hasSkipped)a=this.haveMultiplyConfirmedCenters();else{var u=this.findRowSkip();u>o[2]&&(s+=u-o[2]-i,d=r-1)}else{do d++;while(d<r&&!e[d+s*G.width]);d--}c=0,o[0]=0,o[1]=0,o[2]=0,o[3]=0,o[4]=0}else o[0]=o[2],o[1]=o[3],o[2]=o[4],o[3]=1,o[4]=0,c=3;else o[++c]++;else o[c]++;if(this.foundPatternCross(o)){var h=this.handlePossibleCenter(o,s,r);h&&(i=o[0],this.hasSkipped&&(a=haveMultiplyConfirmedCenters()))}}var f=this.selectBestPatterns();return G.orderBestPatterns(f),new P(f)}}function M(e,t,n){this.x=e,this.y=t,this.count=1,this.estimatedModuleSize=n,this.__defineGetter__("EstimatedModuleSize",function(){return this.estimatedModuleSize}),this.__defineGetter__("Count",function(){return this.count}),this.__defineGetter__("X",function(){return Math.floor(this.x)}),this.__defineGetter__("Y",function(){return Math.floor(this.y)}),this.incrementCount=function(){this.count++},this.aboutEquals=function(e,t,n){if(Math.abs(t-this.y)<=e&&Math.abs(n-this.x)<=e){var r=Math.abs(e-this.estimatedModuleSize);return r<=1||r/this.estimatedModuleSize<=1}return!1}}function E(e,t,n,r,i,a,o){this.image=e,this.possibleCenters=new Array,this.startX=t,this.startY=n,this.width=r,this.height=i,this.moduleSize=a,this.crossCheckStateCount=new Array(0,0,0),this.resultPointCallback=o,this.centerFromEnd=function(e,t){return t-e[2]-e[1]/2},this.foundPatternCross=function(e){for(var t=this.moduleSize,n=t/2,r=0;r<3;r++)if(Math.abs(t-e[r])>=n)return!1;return!0},this.crossCheckVertical=function(e,t,n,r){var i=this.image,a=G.height,o=this.crossCheckStateCount;o[0]=0,o[1]=0,o[2]=0;for(var s=e;s>=0&&i[t+s*G.width]&&o[1]<=n;)o[1]++,s--;if(s<0||o[1]>n)return NaN;for(;s>=0&&!i[t+s*G.width]&&o[0]<=n;)o[0]++,s--;if(o[0]>n)return NaN;for(s=e+1;s<a&&i[t+s*G.width]&&o[1]<=n;)o[1]++,s++;if(s==a||o[1]>n)return NaN;for(;s<a&&!i[t+s*G.width]&&o[2]<=n;)o[2]++,s++;if(o[2]>n)return NaN;var c=o[0]+o[1]+o[2];return 5*Math.abs(c-r)>=2*r?NaN:this.foundPatternCross(o)?this.centerFromEnd(o,s):NaN},this.handlePossibleCenter=function(e,t,n){var r=e[0]+e[1]+e[2],i=this.centerFromEnd(e,n),a=this.crossCheckVertical(t,Math.floor(i),2*e[1],r);if(!isNaN(a)){for(var o=(e[0]+e[1]+e[2])/3,s=this.possibleCenters.length,c=0;c<s;c++){var d=this.possibleCenters[c];if(d.aboutEquals(o,a,i))return new M(i,a,o)}var h=new M(i,a,o);this.possibleCenters.push(h),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(h)}return null},this.find=function(){for(var t=this.startX,i=this.height,a=t+r,o=n+(i>>1),s=new Array(0,0,0),c=0;c<i;c++){var d=o+(0==(1&c)?c+1>>1:-(c+1>>1));s[0]=0,s[1]=0,s[2]=0;for(var h=t;h<a&&!e[h+G.width*d];)h++;for(var u=0;h<a;){if(e[h+d*G.width])if(1==u)s[u]++;else if(2==u){if(this.foundPatternCross(s)){var f=this.handlePossibleCenter(s,d,h);if(null!=f)return f}s[0]=s[2],s[1]=1,s[2]=0,u=1}else s[++u]++;else 1==u&&u++,s[u]++;h++}if(this.foundPatternCross(s)){var f=this.handlePossibleCenter(s,d,a);if(null!=f)return f}}if(0!=this.possibleCenters.length)return this.possibleCenters[0];throw"Couldn't find enough alignment patterns"}}function T(e,t,n){this.blockPointer=0,this.bitPointer=7,this.dataLength=0,this.blocks=e,this.numErrorCorrectionCode=n,
    t<=9?this.dataLengthMode=0:t>=10&&t<=26?this.dataLengthMode=1:t>=27&&t<=40&&(this.dataLengthMode=2),this.getNextBits=function(e){var t=0;if(e<this.bitPointer+1){for(var n=0,r=0;r<e;r++)n+=1<<r;return n<<=this.bitPointer-e+1,t=(this.blocks[this.blockPointer]&n)>>this.bitPointer-e+1,this.bitPointer-=e,t}if(e<this.bitPointer+1+8){for(var i=0,r=0;r<this.bitPointer+1;r++)i+=1<<r;return t=(this.blocks[this.blockPointer]&i)<<e-(this.bitPointer+1),this.blockPointer++,t+=this.blocks[this.blockPointer]>>8-(e-(this.bitPointer+1)),this.bitPointer=this.bitPointer-e%8,this.bitPointer<0&&(this.bitPointer=8+this.bitPointer),t}if(e<this.bitPointer+1+16){for(var i=0,a=0,r=0;r<this.bitPointer+1;r++)i+=1<<r;var o=(this.blocks[this.blockPointer]&i)<<e-(this.bitPointer+1);this.blockPointer++;var s=this.blocks[this.blockPointer]<<e-(this.bitPointer+1+8);this.blockPointer++;for(var r=0;r<e-(this.bitPointer+1+8);r++)a+=1<<r;a<<=8-(e-(this.bitPointer+1+8));var c=(this.blocks[this.blockPointer]&a)>>8-(e-(this.bitPointer+1+8));return t=o+s+c,this.bitPointer=this.bitPointer-(e-8)%8,this.bitPointer<0&&(this.bitPointer=8+this.bitPointer),t}return 0},this.NextMode=function(){return this.blockPointer>this.blocks.length-this.numErrorCorrectionCode-2?0:this.getNextBits(4)},this.getDataLength=function(e){for(var t=0;;){if(e>>t==1)break;t++}return this.getNextBits(G.sizeOfDataLengthInfo[this.dataLengthMode][t])},this.getRomanAndFigureString=function(e){var t=e,n=0,r="",i=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":");do if(t>1){n=this.getNextBits(11);var a=Math.floor(n/45),o=n%45;r+=i[a],r+=i[o],t-=2}else 1==t&&(n=this.getNextBits(6),r+=i[n],t-=1);while(t>0);return r},this.getFigureString=function(e){var t=e,n=0,r="";do t>=3?(n=this.getNextBits(10),n<100&&(r+="0"),n<10&&(r+="0"),t-=3):2==t?(n=this.getNextBits(7),n<10&&(r+="0"),t-=2):1==t&&(n=this.getNextBits(4),t-=1),r+=n;while(t>0);return r},this.get8bitByteArray=function(e){var t=e,n=0,r=new Array;do n=this.getNextBits(8),r.push(n),t--;while(t>0);return r},this.getKanjiString=function(e){var t=e,n=0,r="";do{n=getNextBits(13);var i=n%192,a=n/192,o=(a<<8)+i,s=0;s=o+33088<=40956?o+33088:o+49472,r+=String.fromCharCode(s),t--}while(t>0);return r},this.__defineGetter__("DataByte",function(){for(var e=new Array,t=1,n=2,r=4,i=8;;){var a=this.NextMode();if(0==a){if(e.length>0)break;throw"Empty data block"}if(a!=t&&a!=n&&a!=r&&a!=i)throw"Invalid mode: "+a+" in (block:"+this.blockPointer+" bit:"+this.bitPointer+")";if(dataLength=this.getDataLength(a),dataLength<1)throw"Invalid data length: "+dataLength;switch(a){case t:for(var o=this.getFigureString(dataLength),s=new Array(o.length),c=0;c<o.length;c++)s[c]=o.charCodeAt(c);e.push(s);break;case n:for(var o=this.getRomanAndFigureString(dataLength),s=new Array(o.length),c=0;c<o.length;c++)s[c]=o.charCodeAt(c);e.push(s);break;case r:var d=this.get8bitByteArray(dataLength);e.push(d);break;case i:var o=this.getKanjiString(dataLength);e.push(o)}}return e})}function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var D={};GridSampler={},GridSampler.checkAndNudgePoints=function(e,t){for(var n=G.width,r=G.height,i=!0,a=0;a<t.length&&i;a+=2){var o=Math.floor(t[a]),s=Math.floor(t[a+1]);if(o<-1||o>n||s<-1||s>r)throw"Error.checkAndNudgePoints ";i=!1,o==-1?(t[a]=0,i=!0):o==n&&(t[a]=n-1,i=!0),s==-1?(t[a+1]=0,i=!0):s==r&&(t[a+1]=r-1,i=!0)}i=!0;for(var a=t.length-2;a>=0&&i;a-=2){var o=Math.floor(t[a]),s=Math.floor(t[a+1]);if(o<-1||o>n||s<-1||s>r)throw"Error.checkAndNudgePoints ";i=!1,o==-1?(t[a]=0,i=!0):o==n&&(t[a]=n-1,i=!0),s==-1?(t[a+1]=0,i=!0):s==r&&(t[a+1]=r-1,i=!0)}},GridSampler.sampleGrid3=function(e,t,n){for(var r=new c(t),i=new Array(t<<1),a=0;a<t;a++){for(var o=i.length,s=a+.5,d=0;d<o;d+=2)i[d]=(d>>1)+.5,i[d+1]=s;n.transformPoints1(i),GridSampler.checkAndNudgePoints(e,i);try{for(var d=0;d<o;d+=2){var h=4*Math.floor(i[d])+Math.floor(i[d+1])*G.width*4,u=e[Math.floor(i[d])+G.width*Math.floor(i[d+1])];G.imagedata.data[h]=u?255:0,G.imagedata.data[h+1]=u?255:0,G.imagedata.data[h+2]=0,G.imagedata.data[h+3]=255,u&&r.set_Renamed(d>>1,a)}}catch(f){throw"Error.checkAndNudgePoints"}}return r},GridSampler.sampleGridx=function(e,t,n,r,a,o,s,c,d,h,u,f,l,w,p,m,v,g){var y=i.quadrilateralToQuadrilateral(n,r,a,o,s,c,d,h,u,f,l,w,p,m,v,g);return GridSampler.sampleGrid3(e,t,y)},n.VERSION_DECODE_INFO=new Array(31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017),n.VERSIONS=r(),n.getVersionForNumber=function(e){if(e<1||e>40)throw"ArgumentException";return n.VERSIONS[e-1]},n.getProvisionalVersionForDimension=function(e){if(e%4!=1)throw"Error getProvisionalVersionForDimension";try{return n.getVersionForNumber(e-17>>2)}catch(t){throw"Error getVersionForNumber"}},n.decodeVersionInformation=function(e){for(var t=4294967295,r=0,i=0;i<n.VERSION_DECODE_INFO.length;i++){var a=n.VERSION_DECODE_INFO[i];if(a==e)return this.getVersionForNumber(i+7);var s=o.numBitsDiffering(e,a);s<t&&(r=i+7,t=s)}return t<=3?this.getVersionForNumber(r):null},i.quadrilateralToQuadrilateral=function(e,t,n,r,i,a,o,s,c,d,h,u,f,l,w,p){var m=this.quadrilateralToSquare(e,t,n,r,i,a,o,s),v=this.squareToQuadrilateral(c,d,h,u,f,l,w,p);return v.times(m)},i.squareToQuadrilateral=function(e,t,n,r,a,o,s,c){return dy2=c-o,dy3=t-r+o-c,0==dy2&&0==dy3?new i(n-e,a-n,e,r-t,o-r,t,0,0,1):(dx1=n-a,dx2=s-a,dx3=e-n+a-s,dy1=r-o,denominator=dx1*dy2-dx2*dy1,a13=(dx3*dy2-dx2*dy3)/denominator,a23=(dx1*dy3-dx3*dy1)/denominator,new i(n-e+a13*n,s-e+a23*s,e,r-t+a13*r,c-t+a23*c,t,a13,a23,1))},i.quadrilateralToSquare=function(e,t,n,r,i,a,o,s){return this.squareToQuadrilateral(e,t,n,r,i,a,o,s).buildAdjoint()};var x=21522,A=new Array(new Array(21522,0),new Array(20773,1),new Array(24188,2),new Array(23371,3),new Array(17913,4),new Array(16590,5),new Array(20375,6),new Array(19104,7),new Array(30660,8),new Array(29427,9),new Array(32170,10),new Array(30877,11),new Array(26159,12),new Array(25368,13),new Array(27713,14),new Array(26998,15),new Array(5769,16),new Array(5054,17),new Array(7399,18),new Array(6608,19),new Array(1890,20),new Array(597,21),new Array(3340,22),new Array(2107,23),new Array(13663,24),new Array(12392,25),new Array(16177,26),new Array(14854,27),new Array(9396,28),new Array(8579,29),new Array(11994,30),new Array(11245,31)),O=new Array(0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4);o.numBitsDiffering=function(e,t){return e^=t,O[15&e]+O[15&S(e,4)]+O[15&S(e,8)]+O[15&S(e,12)]+O[15&S(e,16)]+O[15&S(e,20)]+O[15&S(e,24)]+O[15&S(e,28)]},o.decodeFormatInformation=function(e){var t=o.doDecodeFormatInformation(e);return null!=t?t:o.doDecodeFormatInformation(e^x)},o.doDecodeFormatInformation=function(e){for(var t=4294967295,n=0,r=0;r<A.length;r++){var i=A[r],a=i[0];if(a==e)return new o(i[1]);var s=this.numBitsDiffering(e,a);s<t&&(n=i[1],t=s)}return t<=3?new o(n):null},s.forBits=function(e){if(e<0||e>=F.length)throw"ArgumentException";return F[e]};var N=new s(0,1,"L"),I=new s(1,0,"M"),L=new s(2,3,"Q"),B=new s(3,2,"H"),F=new Array(I,N,B,L);d.getDataBlocks=function(e,t,n){if(e.length!=t.TotalCodewords)throw"ArgumentException";for(var r=t.getECBlocksForLevel(n),i=0,a=r.getECBlocks(),o=0;o<a.length;o++)i+=a[o].Count;for(var s=new Array(i),c=0,h=0;h<a.length;h++)for(var u=a[h],o=0;o<u.Count;o++){var f=u.DataCodewords,l=r.ECCodewordsPerBlock+f;s[c++]=new d(f,new Array(l))}for(var w=s[0].codewords.length,p=s.length-1;p>=0;){var m=s[p].codewords.length;if(m==w)break;p--}p++;for(var v=w-r.ECCodewordsPerBlock,g=0,o=0;o<v;o++)for(var h=0;h<c;h++)s[h].codewords[o]=e[g++];for(var h=p;h<c;h++)s[h].codewords[v]=e[g++];for(var y=s[0].codewords.length,o=v;o<y;o++)for(var h=0;h<c;h++){var b=h<p?o:o+1;s[h].codewords[b]=e[g++]}return s},DataMask={},DataMask.forReference=function(e){if(e<0||e>7)throw"System.ArgumentException";return DataMask.DATA_MASKS[e]},DataMask.DATA_MASKS=new Array(new u,new f,new l,new w,new p,new m,new v,new g),C.QR_CODE_FIELD=new C(285),C.DATA_MATRIX_FIELD=new C(301),C.addOrSubtract=function(e,t){return e^t},Decoder={},Decoder.rsDecoder=new y(C.QR_CODE_FIELD),Decoder.correctErrors=function(e,t){for(var n=e.length,r=new Array(n),i=0;i<n;i++)r[i]=255&e[i];var a=e.length-t;try{Decoder.rsDecoder.decode(r,a)}catch(o){throw o}for(var i=0;i<t;i++)e[i]=r[i]},Decoder.decode=function(e){for(var t=new h(e),n=t.readVersion(),r=t.readFormatInformation().ErrorCorrectionLevel,i=t.readCodewords(),a=d.getDataBlocks(i,n,r),o=0,s=0;s<a.length;s++)o+=a[s].NumDataCodewords;for(var c=new Array(o),u=0,f=0;f<a.length;f++){var l=a[f],w=l.Codewords,p=l.NumDataCodewords;Decoder.correctErrors(w,p);for(var s=0;s<p;s++)c[u++]=w[s]}var m=new T(c,n.VersionNumber,r.Bits);return m};var G={};G.imagedata=null,G.width=0,G.height=0,G.qrCodeSymbol=null,G.debug=!1,G.maxImgSize=1048576,G.sizeOfDataLengthInfo=[[10,9,8,8],[12,11,16,10],[14,13,16,12]],G.decode=function(e){return G.width=e.width,G.height=e.height,G.imagedata=e,G.result=G.process(),G.result},G.process=function(){for(var e=G.grayScaleToBitmap(G.grayscale()),t=new a(e),n=t.detect(),r=Decoder.decode(n.bits),i=r.DataByte,o="",s=0;s<i.length;s++)for(var c=0;c<i[s].length;c++)o+=String.fromCharCode(i[s][c]);return G.decode_utf8(o)},G.decode_utf8=function(e){return G.isUrl(e)?G.decode_url(e):e},G.decode_url=function(e){var t="";try{t=escape(e)}catch(n){t=e}var r="";try{r=decodeURIComponent(t)}catch(n){r=t}return r},G.isUrl=function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return t.test(e)},G.getPixel=function(e,t){var n,r;if(G.width<e)throw"point error";if(G.height<t)throw"point error";return n=4*e+t*G.width*4,r=(33*G.imagedata.data[n]+34*G.imagedata.data[n+1]+33*G.imagedata.data[n+2])/100},G.binarize=function(e){for(var t=new Array(G.width*G.height),n=0;n<G.height;n++)for(var r=0;r<G.width;r++){var i=G.getPixel(r,n);t[r+n*G.width]=i<=e}return t},G.grayscale=function(){for(var e=new Array(G.width*G.height),t=0;t<G.height;t++)for(var n=0;n<G.width;n++){var r=G.getPixel(n,t);e[n+t*G.width]=r}return e},G.grayScaleToBitmap=function(e){for(var t=G.getMiddleBrightnessPerArea(e),n=t.length,r=Math.floor(G.width/n),i=Math.floor(G.height/n),a=new Array(G.height*G.width),o=0;o<n;o++)for(var s=0;s<n;s++)for(var c=0;c<i;c++)for(var d=0;d<r;d++)a[r*s+d+(i*o+c)*G.width]=e[r*s+d+(i*o+c)*G.width]<t[s][o];return a},G.getMiddleBrightnessPerArea=function(e){for(var t=4,n=Math.floor(G.width/t),r=Math.floor(G.height/t),i=new Array(t),a=0;a<t;a++){i[a]=new Array(t);for(var o=0;o<t;o++)i[a][o]=new Array(0,0)}for(var s=0;s<t;s++)for(var c=0;c<t;c++){i[c][s][0]=255;for(var d=0;d<r;d++)for(var h=0;h<n;h++){var u=e[n*c+h+(r*s+d)*G.width];u<i[c][s][0]&&(i[c][s][0]=u),u>i[c][s][1]&&(i[c][s][1]=u)}}for(var f=new Array(t),l=0;l<t;l++)f[l]=new Array(t);for(s=0;s<t;s++)for(c=0;c<t;c++)f[c][s]=Math.floor((i[c][s][0]+i[c][s][1])/2);return f},Array.prototype.remove=function(e,t){var n=this.slice((t||e)+1||this.length);return this.length=e<0?this.length+e:e,this.push.apply(this,n)};var j=3,U=57,V=8,z=2;G.orderBestPatterns=function(e){function t(e,t){return xDiff=e.X-t.X,yDiff=e.Y-t.Y,Math.sqrt(xDiff*xDiff+yDiff*yDiff)}function n(e,t,n){var r=t.x,i=t.y;return(n.x-r)*(e.y-i)-(n.y-i)*(e.x-r)}var r,i,a,o=t(e[0],e[1]),s=t(e[1],e[2]),c=t(e[0],e[2]);if(s>=o&&s>=c?(i=e[0],r=e[1],a=e[2]):c>=s&&c>=o?(i=e[1],r=e[0],a=e[2]):(i=e[2],r=e[0],a=e[1]),n(r,i,a)<0){var d=r;r=a,a=d}e[0]=r,e[1]=i,e[2]=a},function(e){if("object"==typeof D&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.adapter=e()}}(function(){return function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!s&&c)return c(o,!0);if(a)return a(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var h=n[o]={exports:{}};t[o][0].call(h.exports,function(e){var n=t[o][1][e];return i(n?n:e)},h,h.exports,e,t,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){"use strict";var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},r.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+" "+e.parameter+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.getDtlsParameters=function(e,t){var n=r.splitLines(e);n=n.concat(r.splitLines(t));var i=n.filter(function(e){return 0===e.indexOf("a=fingerprint:")})[0].substr(14),a={role:"auto",fingerprints:[{algorithm:i.split(" ")[0],value:i.split(" ")[1]}]};return a},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);n=n.concat(r.splitLines(t));var i={usernameFragment:n.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return i},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e),i=n[0].split(" "),a=3;a<i.length;a++){var o=i[a],s=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){var c=r.parseRtpMap(s),d=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(c.parameters=d.length?r.parseFmtp(d[0]):{},c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";return n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)}),n+="a=rtcp-mux\r\n"},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),a=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{payloadType:e.payloadType,ssrc:t}};n.push(r),a&&(r=JSON.parse(JSON.stringify(r)),r.fec={ssrc:t,mechanism:o?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var h=r.matchPrefix(e,"b=");return h.length&&(0===h[0].indexOf("b=TIAS:")?h=parseInt(h[0].substr(7),10):0===h[0].indexOf("b=AS:")&&(h=parseInt(h[0].substr(5),10)),n.forEach(function(e){e.maxBitrate=h})),n},r.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),a+="a=mid:"+e.mid+"\r\n",a+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+o,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n"},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},t.exports=r},{}],2:[function(e,t,n){"use strict";!function(){var n=e("./utils").log,r=e("./utils").browserDetails;t.exports.browserDetails=r,t.exports.extractVersion=e("./utils").extractVersion,t.exports.disableLog=e("./utils").disableLog;var i=e("./chrome/chrome_shim")||null,a=e("./edge/edge_shim")||null,o=e("./firefox/firefox_shim")||null,s=e("./safari/safari_shim")||null;switch(r.browser){case"opera":case"chrome":if(!i||!i.shimPeerConnection)return void n("Chrome shim is not included in this adapter release.");n("adapter.js shimming chrome."),t.exports.browserShim=i,i.shimGetUserMedia(),i.shimMediaStream(),i.shimSourceObject(),i.shimPeerConnection(),i.shimOnTrack();break;case"firefox":if(!o||!o.shimPeerConnection)return void n("Firefox shim is not included in this adapter release.");n("adapter.js shimming firefox."),t.exports.browserShim=o,o.shimGetUserMedia(),o.shimSourceObject(),o.shimPeerConnection(),o.shimOnTrack();break;case"edge":if(!a||!a.shimPeerConnection)return void n("MS edge shim is not included in this adapter release.");n("adapter.js shimming edge."),t.exports.browserShim=a,a.shimGetUserMedia(),a.shimPeerConnection();break;case"safari":if(!s)return void n("Safari shim is not included in this adapter release.");n("adapter.js shimming safari."),t.exports.browserShim=s,s.shimGetUserMedia();break;default:n("Unsupported browser!")}}()},{"./chrome/chrome_shim":3,"./edge/edge_shim":5,"./firefox/firefox_shim":7,"./safari/safari_shim":9,"./utils":10}],3:[function(e,t,n){"use strict";var r=e("../utils.js").log,i=e("../utils.js").browserDetails,a={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(n){var r=new Event("track");r.track=n.track,r.receiver={track:n.track},r.streams=[e.stream],t.dispatchEvent(r)}),e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;return this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),e?(this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),void e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})):void(this.src="")}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(e,t){r("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=new webkitRTCPeerConnection(e,t),i=n.getStats.bind(n);return n.getStats=function(e,t,n){var r=this,a=arguments;if(arguments.length>0&&"function"==typeof e)return i(e,t);var o=function(e){var t={},n=e.result();return n.forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e,t){var n=new Map(Object.keys(e).map(function(t){return[t,e[t]]}));return t=t||e,Object.keys(t).forEach(function(e){n[e]=t[e]}),n};if(arguments.length>=2){var c=function(e){a[1](s(o(e)))};return i.apply(this,[c,arguments[0]])}return new Promise(function(t,n){1===a.length&&"object"==typeof e?i.apply(r,[function(e){t(s(o(e)))},n]):i.apply(r,[function(e){t(s(o(e),e.result()))},n])}).then(t,n)},n},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),i.version<51&&(["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){t.apply(e,[r,i,n])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this,r=new Promise(function(r,i){t.apply(n,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}));var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)},["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}})},attachMediaStream:function(e,t){r("DEPRECATED, attachMediaStream will soon be removed."),i.version>=43?e.srcObject=t:"undefined"!=typeof e.src?e.src=URL.createObjectURL(t):r("Error attaching stream to element.")},reattachMediaStream:function(e,t){r("DEPRECATED, reattachMediaStream will soon be removed."),i.version>=43?e.srcObject=t.srcObject:e.src=t.src}};t.exports={shimMediaStream:a.shimMediaStream,shimOnTrack:a.shimOnTrack,shimSourceObject:a.shimSourceObject,shimPeerConnection:a.shimPeerConnection,shimGetUserMedia:e("./getusermedia"),attachMediaStream:a.attachMediaStream,reattachMediaStream:a.reattachMediaStream}},{"../utils.js":10,"./getusermedia":4}],4:[function(e,t,n){"use strict";var r=e("../utils.js").log;t.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var a={};"number"==typeof r.ideal?(a[i("min",n)]=r.ideal,t.optional.push(a),a={},a[i("max",n)]=r.ideal,t.optional.push(a)):(a[i("",n)]=r.ideal,t.optional.push(a))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},t=function(t,n){if(t=JSON.parse(JSON.stringify(t)),t&&t.audio&&(t.audio=e(t.audio)),t&&"object"==typeof t.video){var i=t.video.facingMode;if(i=i&&("object"==typeof i?i:{ideal:i}),i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete t.video.facingMode,"environment"===i.exact||"environment"===i.ideal))return navigator.mediaDevices.enumerateDevices().then(function(a){a=a.filter(function(e){return"videoinput"===e.kind});var o=a.find(function(e){return e.label.toLowerCase().indexOf("back")!==-1})||a.length&&a[a.length-1];return o&&(t.video.deviceId=i.exact?{exact:o.deviceId}:{ideal:o.deviceId}),t.video=e(t.video),r("chrome: "+JSON.stringify(t)),n(t)});t.video=e(t.video)}return r("chrome: "+JSON.stringify(t)),n(t)},n=function(e){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},i=function(e,r,i){t(e,function(e){navigator.webkitGetUserMedia(e,r,function(e){i(n(e))})})};navigator.getUserMedia=i;var a=function(e){return new Promise(function(t,n){navigator.getUserMedia(e,t,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:a,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return t(e,function(e){return o(e)["catch"](function(e){return Promise.reject(n(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return a(e)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){r("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){r("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":10}],5:[function(e,t,n){"use strict";var r=e("sdp"),i=e("../utils").log,a={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e})),window.RTCPeerConnection=function(e){var t=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){t[e]=n[e].bind(n)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}e&&e.iceServers&&(this.iceOptions.iceServers=e.iceServers.filter(function(e){return!(!e||!e.urls)&&(e.urls=e.urls.filter(function(e){return 0===e.indexOf("turn:")&&e.indexOf("transport=udp")!==-1})[0],!!e.urls)})),this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this,t=r.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(n){var r=!n.candidate||0===Object.keys(n.candidate).length;if(r)for(var i=1;i<t.length;i++)t[i].indexOf("\r\na=end-of-candidates\r\n")===-1&&(t[i]+="a=end-of-candidates\r\n");else n.candidate.candidate.indexOf("typ endOfCandidates")===-1&&(t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n");if(e.localDescription.sdp=t.join(""),e.dispatchEvent(n),null!==e.onicecandidate&&e.onicecandidate(n),!n.candidate&&"complete"!==e.iceGatheringState){var a=e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});a&&(e.iceGatheringState="complete")}}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(e){this.localStreams.push(e.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var r=0;r<t.codecs.length;r++){var i=t.codecs[r];if(e.name.toLowerCase()===i.name.toLowerCase()&&e.clockRate===i.clockRate&&e.numChannels===i.numChannels){n.codecs.push(i);break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(e,t){
    var n=this,i=new RTCIceGatherer(n.iceOptions),a=new RTCIceTransport(i);i.onlocalcandidate=function(o){var s=new Event("icecandidate");s.candidate={sdpMid:e,sdpMLineIndex:t};var c=o.candidate,d=!c||0===Object.keys(c).length;d?(void 0===i.state&&(i.state="completed"),s.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(c.component="RTCP"===a.component?2:1,s.candidate.candidate=r.writeCandidate(c));var h=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(n.iceGatheringState){case"new":n._localIceCandidatesBuffer.push(s),d&&h&&n._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":n._emitBufferedCandidates(),n.dispatchEvent(s),null!==n.onicecandidate&&n.onicecandidate(s),h&&(n.dispatchEvent(new Event("icecandidate")),null!==n.onicecandidate&&n.onicecandidate(new Event("icecandidate")),n.iceGatheringState="complete");break;case"complete":}},a.onicestatechange=function(){n._updateConnectionState()};var o=new RTCDtlsTransport(a);return o.ondtlsstatechange=function(){n._updateConnectionState()},o.onerror=function(){o.state="failed",n._updateConnectionState()},{iceGatherer:i,iceTransport:a,dtlsTransport:o}},window.RTCPeerConnection.prototype._transceive=function(e,t,n){var i=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:r.localCName},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&(i.encodings=e.recvEncodingParameters,i.rtcp={cname:e.cname},e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var t,n,i=this;if("offer"===e.type)this._pendingOffer&&(t=r.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=r.parseRtpParameters(e);i._pendingOffer[t].localCapabilities=n}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){t=r.splitSections(i.remoteDescription.sdp),n=t.shift();var a=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var o=i.transceivers[t],s=o.iceGatherer,c=o.iceTransport,d=o.dtlsTransport,h=o.localCapabilities,u=o.remoteCapabilities,f="0"===e.split("\n",1)[0].split(" ",2)[1];if(!f){var l=r.getIceParameters(e,n);if(a){var w=r.matchPrefix(e,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return"1"===e.component});c.setRemoteCandidates(w)}c.start(s,l,a?"controlling":"controlled");var p=r.getDtlsParameters(e,n);a&&(p.role="server"),d.start(p);var m=i._getCommonCapabilities(h,u);i._transceive(o,m.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var o=arguments.length>1&&"function"==typeof arguments[1];if(o){var s=arguments[1];window.setTimeout(function(){s(),"new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),i._emitBufferedCandidates()},0)}var c=Promise.resolve();return c.then(function(){o||("new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),window.setTimeout(i._emitBufferedCandidates.bind(i),500))}),c},window.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t=this,n=new MediaStream,i=[],a=r.splitSections(e.sdp),o=a.shift(),s=r.matchPrefix(o,"a=ice-lite").length>0;switch(a.forEach(function(a,c){var d,h,u,f,l,w,p,m,v,g,y,b,C=r.splitLines(a),S=C[0].substr(2).split(" "),k=S[0],P="0"===S[1],_=r.getDirection(a,o),M=r.parseRtpParameters(a);P||(y=r.getIceParameters(a,o),b=r.getDtlsParameters(a,o),b.role="client"),m=r.parseRtpEncodingParameters(a);var E=r.matchPrefix(a,"a=mid:");E=E.length?E[0].substr(6):r.generateIdentifier();var T,R=r.matchPrefix(a,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];R&&(T=R.value);var D=r.matchPrefix(a,"a=end-of-candidates").length>0,x=r.matchPrefix(a,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return"1"===e.component});if("offer"!==e.type||P)"answer"!==e.type||P||(d=t.transceivers[c],h=d.iceGatherer,u=d.iceTransport,f=d.dtlsTransport,l=d.rtpSender,w=d.rtpReceiver,p=d.sendEncodingParameters,v=d.localCapabilities,t.transceivers[c].recvEncodingParameters=m,t.transceivers[c].remoteCapabilities=M,t.transceivers[c].cname=T,(s||D)&&u.setRemoteCandidates(x),u.start(h,y,"controlling"),f.start(b),t._transceive(d,"sendrecv"===_||"recvonly"===_,"sendrecv"===_||"sendonly"===_),!w||"sendrecv"!==_&&"sendonly"!==_?delete d.rtpReceiver:(g=w.track,i.push([g,w]),n.addTrack(g)));else{var A=t._createIceAndDtlsTransports(E,c);if(D&&A.iceTransport.setRemoteCandidates(x),v=RTCRtpReceiver.getCapabilities(k),p=[{ssrc:1001*(2*c+2)}],w=new RTCRtpReceiver(A.dtlsTransport,k),g=w.track,i.push([g,w]),n.addTrack(g),t.localStreams.length>0&&t.localStreams[0].getTracks().length>=c){var O=t.localStreams[0].getTracks()[c];l=new RTCRtpSender(O,A.dtlsTransport)}t.transceivers[c]={iceGatherer:A.iceGatherer,iceTransport:A.iceTransport,dtlsTransport:A.dtlsTransport,localCapabilities:v,remoteCapabilities:M,rtpSender:l,rtpReceiver:w,kind:k,mid:E,cname:T,sendEncodingParameters:p,recvEncodingParameters:m},t._transceive(t.transceivers[c],!1,"sendrecv"===_||"sendonly"===_)}}),this.remoteDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return n.getTracks().length&&(t.remoteStreams.push(n),window.setTimeout(function(){var e=new Event("addstream");e.stream=n,t.dispatchEvent(e),null!==t.onaddstream&&window.setTimeout(function(){t.onaddstream(e)},0),i.forEach(function(r){var i=r[0],a=r[1],o=new Event("track");o.track=i,o.receiver=a,o.streams=[n],t.dispatchEvent(e),null!==t.ontrack&&window.setTimeout(function(){t.ontrack(o)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t=this,n={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){n[e.iceTransport.state]++,n[e.dtlsTransport.state]++}),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0||n.checking>0?e="connecting":n.disconnected>0?e="disconnected":n["new"]>0?e="new":(n.connected>0||n.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this.dispatchEvent(r),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(r)}},window.RTCPeerConnection.prototype.createOffer=function(){var e=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var t;1===arguments.length&&"function"!=typeof arguments[0]?t=arguments[0]:3===arguments.length&&(t=arguments[2]);var n=[],i=0,a=0;if(this.localStreams.length&&(i=this.localStreams[0].getAudioTracks().length,a=this.localStreams[0].getVideoTracks().length),t){if(t.mandatory||t.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==t.offerToReceiveAudio&&(i=t.offerToReceiveAudio),void 0!==t.offerToReceiveVideo&&(a=t.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){n.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?i>0:a>0}),"audio"===e.kind?i--:"video"===e.kind&&a--});i>0||a>0;)i>0&&(n.push({kind:"audio",wantReceive:!0}),i--),a>0&&(n.push({kind:"video",wantReceive:!0}),a--);var o=r.writeSessionBoilerplate(),s=[];n.forEach(function(t,n){var i,a,c=t.track,d=t.kind,h=r.generateIdentifier(),u=e._createIceAndDtlsTransports(h,n),f=RTCRtpSender.getCapabilities(d),l=[{ssrc:1001*(2*n+1)}];c&&(i=new RTCRtpSender(c,u.dtlsTransport)),t.wantReceive&&(a=new RTCRtpReceiver(u.dtlsTransport,d)),s[n]={iceGatherer:u.iceGatherer,iceTransport:u.iceTransport,dtlsTransport:u.dtlsTransport,localCapabilities:f,remoteCapabilities:null,rtpSender:i,rtpReceiver:a,kind:d,mid:h,sendEncodingParameters:l,recvEncodingParameters:null};var w=s[n];o+=r.writeMediaSection(w,w.localCapabilities,"offer",e.localStreams[0])}),this._pendingOffer=s;var c=new RTCSessionDescription({type:"offer",sdp:o});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,c),Promise.resolve(c)},window.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=r.writeSessionBoilerplate();this.transceivers.forEach(function(n){var i=e._getCommonCapabilities(n.localCapabilities,n.remoteCapabilities);t+=r.writeMediaSection(n,i,"answer",e.localStreams[0])});var n=new RTCSessionDescription({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,n),Promise.resolve(n)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){if(null===e)this.transceivers.forEach(function(e){e.iceTransport.addIceCandidate({})});else{var t=e.sdpMLineIndex;if(e.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===e.sdpMid){t=n;break}var i=this.transceivers[t];if(i){var a=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===a.protocol&&0===a.port)return;if("1"!==a.component)return;"endOfCandidates"===a.type&&(a={}),i.iceTransport.addRemoteCandidate(a);var o=r.splitSections(this.remoteDescription.sdp);o[t+1]+=(a.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=o.join("")}}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(n){var r=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){r.set(t,e[t]),r[t]=e[t]})}),t&&window.setTimeout(t,0,r),n(r)})})}},attachMediaStream:function(e,t){i("DEPRECATED, attachMediaStream will soon be removed."),e.srcObject=t},reattachMediaStream:function(e,t){i("DEPRECATED, reattachMediaStream will soon be removed."),e.srcObject=t.srcObject}};t.exports={shimPeerConnection:a.shimPeerConnection,shimGetUserMedia:e("./getusermedia"),attachMediaStream:a.attachMediaStream,reattachMediaStream:a.reattachMediaStream}},{"../utils":10,"./getusermedia":6,sdp:1}],6:[function(e,t,n){"use strict";t.exports=function(){var e=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(n){return t(n)["catch"](function(t){return Promise.reject(e(t))})}}},{}],7:[function(e,t,n){"use strict";var r=e("../utils").log,i=e("../utils").browserDetails,a={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(i.version<38&&e&&e.iceServers){for(var n=[],r=0;r<e.iceServers.length;r++){var a=e.iceServers[r];if(a.hasOwnProperty("urls"))for(var o=0;o<a.urls.length;o++){var s={url:a.urls[o]};0===a.urls[o].indexOf("turn")&&(s.username=a.username,s.credential=a.credential),n.push(s)}else n.push(e.iceServers[r])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)};var t=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},n=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,r,i){return n.apply(this,[e||null]).then(function(e){return t(e)}).then(r,i)}}},shimGetUserMedia:function(){var e=function(e,t,n){var a=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),i.version<38&&(r("spec: "+JSON.stringify(e)),e.audio&&(e.audio=a(e.audio)),e.video&&(e.video=a(e.video)),r("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,t,n)};navigator.getUserMedia=e;var t=function(e){return new Promise(function(t,n){navigator.getUserMedia(e,t,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:t,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},i.version<41){var n=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return n().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}},attachMediaStream:function(e,t){r("DEPRECATED, attachMediaStream will soon be removed."),e.srcObject=t},reattachMediaStream:function(e,t){r("DEPRECATED, reattachMediaStream will soon be removed."),e.srcObject=t.srcObject}};t.exports={shimOnTrack:a.shimOnTrack,shimSourceObject:a.shimSourceObject,shimPeerConnection:a.shimPeerConnection,shimGetUserMedia:e("./getusermedia"),attachMediaStream:a.attachMediaStream,reattachMediaStream:a.reattachMediaStream}},{"../utils":10,"./getusermedia":8}],8:[function(e,t,n){"use strict";var r=e("../utils").log,i=e("../utils").browserDetails;t.exports=function(){var e=function(e){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},t=function(t,n,a){var o=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return t=JSON.parse(JSON.stringify(t)),i.version<38&&(r("spec: "+JSON.stringify(t)),t.audio&&(t.audio=o(t.audio)),t.video&&(t.video=o(t.video)),r("ff37: "+JSON.stringify(t))),navigator.mozGetUserMedia(t,n,function(t){a(e(t))})};navigator.getUserMedia=t;var n=function(e){return new Promise(function(t,n){navigator.getUserMedia(e,t,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:n,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},i.version<41){var a=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return a().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(i.version<49){var o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return o(t)["catch"](function(t){return Promise.reject(e(t))})}}}},{"../utils":10}],9:[function(e,t,n){"use strict";var r={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};t.exports={shimGetUserMedia:r.shimGetUserMedia}},{}],10:[function(e,t,n){"use strict";var r=!0,i={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(){var e={};if(e.browser=null,e.version=null,e.minVersion=null,"undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),e.minVersion=31;else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),e.minVersion=38;else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1),e.minVersion=602}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return e.browser="Not a supported browser.",e;e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),e.minVersion=10547}return e.version<e.minVersion&&i.log("Browser: "+e.browser+" Version: "+e.version+" < minimum supported version: "+e.minVersion+"\n some things might not work!"),e}};t.exports={log:i.log,disableLog:i.disableLog,browserDetails:i.detectBrowser(),extractVersion:i.extractVersion}},{}]},{},[2])(2)}),Object.defineProperty(D,"__esModule",{value:!0});var q=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),X=function(){function e(t){R(this,e);var n=t.videoSelector;this._stopOnRead=t.stopOnRead,this._video=null,this._context=null,this._mediaStream=null,this._stopped=!1,this._defaultHeight=480,this._defaultWidth=640,this._deviceId=t.deviceId,this._startOnCreate=t.startOnCreate||!0,this.onSuccess=t.sucessCallback,this.onError=t.errorCallback,this._video=this._createVideoElement(n),this._width=this._video.width,this._height=this._video.height,this._context=this._createContext2D(this._video),this._startOnCreate&&this.start()}return q(e,[{key:"start",value:function(){var e={video:{height:this._defaultHeight,width:this._defaultWidth}};this._deviceId&&(e.video.deviceId=this._deviceId),navigator.getUserMedia(e,this._onMediaStream.bind(this),this._onMediaStreamError.bind(this))}},{key:"stop",value:function(){this._stopStreams()}},{key:"_createVideoElement",value:function(e){if(e)return document.querySelector(e);var t=document.createElement("video");return t.setAttribute("width",this._defaultWidth),t.setAttribute("height",this._defaultHeight),t}},{key:"_createContext2D",value:function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d")}},{key:"_onMediaStream",value:function(e){this._mediaStream=e,this._video.src=URL.createObjectURL(e),this._video.play(),requestAnimationFrame(this._onAnimationFrameRequested.bind(this))}},{key:"_onMediaStreamError",value:function(e){console.error(e)}},{key:"_onAnimationFrameRequested",value:function(){if(!this._stopped){this._context.drawImage(this._video,0,0,this._width,this._height);var e=this._context.getImageData(0,0,this._width,this._height);this._decode(e),requestAnimationFrame(this._onAnimationFrameRequested.bind(this))}}},{key:"_decode",value:function(e){var t="";try{t=G.decode(e)}catch(n){if(this._isExpectedError(n))return;console.error("Unexpected error: ",n),this.onError(n)}""!==t&&this._stopOnRead&&this._stopStreams(),""!==t&&this.onSuccess(t)}},{key:"_isExpectedError",value:function(e){return String(e).indexOf("Couldn't find enough")>=0}},{key:"_stopStreams",value:function(){this._stopped=!0,this._video.pause(),this._mediaStream.getVideoTracks().forEach(function(e){e.stop()})}}],[{key:"getBackCamera",value:function(){return navigator.mediaDevices.enumerateDevices().then(function(e){e=e.filter(function(e){return"videoinput"===e.kind});var t=e.find(function(e){return e.label.toLowerCase().includes("back")});return t?t:e.shift()})}}]),e}();D["default"]=X,window.QrReader=X}();